{% extends 'front/home_index.html' %}
{% load staticfiles %}
{% block template %}
      <section class="widget-box home-layout">
            <h3 class="post_box_title">
                <span class="ttcolor">
                    <i class="fa fa-cube"></i>
                    今日头条
                </span>
            </h3>
             {% for item in article %}
                  <article class="post_box">
                  <div class="post-img col-xs-4">
                        <a href="">
                              <img class="img-responsive img-rounded imgs" src="https://www.talklee.com/zb_users/upload/2018/06/201806281530153436570309.jpg" alt="{{ item.articleName }}" title="详细阅读：{{ item.articleName }}" original="https://www.talklee.com/zb_users/upload/2018/06/201806291530261215908089.jpg" style="display: inline;">
                              <em></em>
                        </a>
                  </div>
                  <div class="post-left">
                        <h3>
                            <a href="{% url 'blog:article-detail'  item.articleUrl item.articleClick%}" title=" {{ item.articleName }}"> {{ item.articleName }}</a>
                        </h3>
                        <div class="post-con">
                            <a href="{% url 'blog:article-detail'  item.articleUrl item.articleClick%}" title="查看《 {{ item.articleName }}》全文"> {{ item.articleContent }}</a>
                        </div>
                        <div class="item-meta">
                              <span class="mu-ml">
                                  <i class="fa fa-user"></i>
                                  <a href="{% url 'blog:user_blog' item.user.userName %}">{{ item.user.userName }}</a>
                              </span>
                              <span class="mu-ml-clock">
                                  <i class="fa fa-calendar"></i>
                                  {{ item.articleTime|date:"Y-m-d"}}
                              </span>
                              <span class="mu-ml-eye">
                                  <i class="fa fa-paw"></i>
                                  {{ item.articleClick }}次浏览
                              </span>
                              <span class="mu-ml-comment">
                                  <i class="fa fa-comment"></i>
                                  <a href="https://www.talklee.com/blog/361.html#comments">{{ item.articleComment }}条评论</a>
                              </span>
                              <a class="read-more right" href="{% url 'blog:article-detail'  item.articleUrl item.articleClick%}" title="详细阅读：{{ item.articleName }}">阅读全文</a>
                        </div>
                  </div>
            </article>
             {% endfor %}
      </section>
      <div class="page-ico">
           <img src="{% static 'images/loading.gif' %}">
      </div>
{% endblock %}
{% block side %}
      <aside class="sidebar-right"
               style="position: relative; overflow: visible; box-sizing: border-box; min-height: 0px;">
            <div class="theiaStickySidebar">
                <div class="widget-box widget" id="zzxx-box">
                    <div class="topauthor">
                        <img alt="博客主人：向勇" src="{% static 'images/IMG_1911.JPG' %}" class="avatar-photo"
                             title="向勇" height="100" width="100">
                        <span class="intag" title="向勇">博 主：</span>
                        <span class="names">
                                                    <a href="https://www.talklee.com/author-1.html"
                                                       title="查看 向勇 发布的文章" rel="author">向勇</a>
                                                </span>
                        <span class="talk">向勇个人博客，是一个记录生活点滴专注分享干货资料，技术答疑的个人平台，你们也可以在我博客上写文章分享资源</span>
                    </div>
                    <ul>
                        <li class="tsina">
                            <a title="新浪微博" rel="nofollow" href="http://weibo.com/523912300/" target="_blank">
                                <i class="fa fa-weibo"></i>
                            </a>
                        </li>
                        <li class="weixin"><a title="微信">
                            <i class="fa fa-weixin"></i>
                            <span style="background-image:url(https://www.talklee.com/zb_users/theme//talklee/style/images/wxlogo_example.png);"></span>
                        </a>
                        </li>
                        <li class="tqq">
                            <a title="QQ临时对话" rel="nofollow"
                               href="//wpa.qq.com/msgrd?v=3&amp;uin=229693666&amp;site=qq&amp;menu=yes" target="blank">
                                <i class="fa fa-qq"></i>
                            </a>
                        </li>
                        <li class="feed">
                            <a title="主题交流群"
                               href="https://shang.qq.com/wpa/qunwpa?idkey=c30722f3c9cba68d73b80ad8635ba992a9f29a0eeb127c3b789f5d4e668a6552"
                               rel="nofollow" target="_blank">
                                <i class="fa fa-users"></i>
                            </a>
                        </li>
                    </ul>
                    <div class="butauthor ">
                        <span class="bignum pn">浏览 {{ data.user_info.userView }} 次</span>
                        <span class="bignum">积分{{ data.user_info.userMark }}</span>
                    </div>
                </div>
                <div class="widget-box widget" id="tabcelan">
                    <ul class="widget-content tabcelan">
                        <li id="con_title" class="con_post_title">
                            <ul id="tab">
                                <li index="1" class="tabhover">热门</li>
                                <li index="2">热评</li>
                                <li index="3">最新文章</li>
                            </ul>
                        </li>
                        <li id="con_one" class="con_one_list">
                            <ul index="1"  style="display:block;">
                                {% for item in data.article_hot %}
                                     <li>
                                        <span class="li-icon li-icon-{{ forloop.counter }}">{{ forloop.counter }}</span>
                                        <a href="{% url 'blog:article-detail' item.articleUrl item.articleClick %}"
                                       title="{{ item.articleName }}" target="_blank">{{ item.articleName }}</a>
                                     </li>
                                {% endfor %}
                            </ul>
                            <ul index="2" style="display:none;">
                                {% for item in data.article_hot_comment %}
                                     <li>
                                        <span class="li-icon li-icon-{{ forloop.counter }}">{{ forloop.counter }}</span>
                                        <a href="{% url 'blog:article-detail' item.articleUrl item.articleClick %}"
                                       title="{{ item.articleName }}" target="_blank">{{ item.articleName }}</a>
                                     </li>
                                {% endfor %}
                            </ul>
                            <ul index="3" style="display:none;">
                                {% for item in data.article_wz %}
                                     <li>
                                        <span class="li-icon li-icon-{{ forloop.counter }}">{{ forloop.counter }}</span>
                                        <a href="{% url 'blog:article-detail' item.articleUrl item.articleClick %}"
                                       title="{{ item.articleName }}" target="_blank">{{ item.articleName }}</a>
                                     </li>
                                {% endfor %}
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="widget-box widget" id="side_randimg" style="visibility: visible; animation-name: fadeInDown;">
                    <h3 class="widget-title"><i class="fa fa-th"></i>图文推荐</h3>
                    <ul class="widget-content side_randimg">
                        {% for item in article_tj %}
                             <li><a href="https://www.talklee.com/blog/355.html" title="网站被DDOS攻击的防御方法">
                            <div class="hotpost-img"><img
                                    src="https://www.talklee.com/zb_users/upload/2018/06/201806041528078999190291.jpg"
                                    alt="网站被DDOS攻击的防御方法" class="randsimg"></div>
                            <div class="hotpost-left"><span class="hot-post-title">{{ item.articleName }}</span><span
                                    class="hot-post-clock"><i class="fa fa-clock-o"></i>{{ item.articleTime|date:"Y-m-d"}}</span><span
                                    class="hot-post-info"><i class="fa fa-comment"></i> {{ item.articleComment }}</span></div>
                        </a></li>
                        {% endfor %}

                    </ul>
                </div>
            </div>
        </aside>
{% endblock %}
{% block script %}
    <script>
        $(function () {
            //分页
              var flag=true
            $(window).scroll(function () {
                var scrollTop = $(this).scrollTop();
                var scrollHeight = $(document).height();
                var windowHeight = $(this).height();
                if (scrollTop + windowHeight == scrollHeight) {
                    if(flag){
                        $(".page-ico").show()
                        var offset = $("section article").length
                        var limit =  offset + 4
                        $.ajax({
                            url: "{% url 'blog:page' %}",
                            method: "GET",
                            data: {"offset": offset, "limit": limit},
                            dataType: "JSON",
                            beforeSend: function () {
                                flag = false
                            },
                            success: function (data) {
                                if (data.code == 0) {
                                    if (data.data.length > 0) {
                                        $.each(data.data, function (index, v) {
                                            var template = "<article style='display:none' class=\"post_box\">\n" +
                                                "                  <div class=\"post-img col-xs-4\">\n" +
                                                "                        <a href=\"\">\n" +
                                                "                              <img class=\"img-responsive img-rounded imgs\" src=\"https://www.talklee.com/zb_users/upload/2018/06/201806281530153436570309.jpg\" alt=\"{title}\" title=\"详细阅读{title}\" original=\"https://www.talklee.com/zb_users/upload/2018/06/201806291530261215908089.jpg\" style=\"display: inline;\">\n" +
                                                "                              <em></em>\n" +
                                                "                        </a>\n" +
                                                "                  </div>\n" +
                                                "                  <div class=\"post-left\">\n" +
                                                "                        <h3>\n" +
                                                "                            <a href=\"/article-detail-{url}-{url_view}.html/\" title=\" {title}\">{title}</a>\n" +
                                                "                        </h3>\n" +
                                                "                        <div class=\"post-con\">\n" +
                                                "                            <a href=\"/article-detail-{url}-{url_view}.html/\" title=\"查看《 {title}》全文\"> {content}</a>\n" +
                                                "                        </div>\n" +
                                                "                        <div class=\"item-meta\">\n" +
                                                "                              <span class=\"mu-ml\">\n" +
                                                "                                  <i class=\"fa fa-user\"></i>\n" +
                                                "                                  <a href=\"/user-{user}.html/\">{user}</a>\n" +
                                                "                              </span>\n" +
                                                "                              <span class=\"mu-ml-clock\">\n" +
                                                "                                  <i class=\"fa fa-calendar\"></i>\n" +
                                                "                                  {time}\n" +
                                                "                              </span>\n" +
                                                "                              <span class=\"mu-ml-eye\">\n" +
                                                "                                  <i class=\"fa fa-paw\"></i>\n" +
                                                "                                  {view}次浏览\n" +
                                                "                              </span>\n" +
                                                "                              <span class=\"mu-ml-comment\">\n" +
                                                "                                  <i class=\"fa fa-comment\"></i>\n" +
                                                "                                  <a href=\"https://www.talklee.com/blog/361.html#comments\">{comment}条评论</a>\n" +
                                                "                              </span>\n" +
                                                "                              <a class=\"read-more right\" href=\"/article-detail-{url}-{url_view}.html/\" title=\"详细阅读：{title}\">阅读全文</a>\n" +
                                                "                        </div>\n" +
                                                "                  </div>\n" +
                                                "            </article>"

                                            $("section").append(template.format({
                                                title: v.articleName,
                                                content: v.articleContent,
                                                url: v.articleUrl,
                                                url_view: v.articleClick,
                                                time: v.articleTime,
                                                view: v.articleClick,
                                                comment: v.articleComment,
                                                user: v.user.userName
                                            }))
                                              $("section article").fadeIn("slow")
                                        })
                                        $(".page-ico").hide()
                                        flag=true
                                        if (data.data.length < 4) {
                                            flag = false
                                        }
                                    } else {
                                        flag = false
                                        $(".page-ico").hide()
                                    }

                                }
                            },
                            error: function (data) {
                                console.log(data)
                            }
                        })
                    }

                }
            });


              $(".con_one_list ul,.widget-content.tabcelan").css({"max-height":'max-content'})
            $("#con_title #tab li").hover(function () {
                if(!$(this).hasClass("tabhover")){
                    $("#con_title #tab li").removeClass("tabhover")
                    $(".con_one_list ul").hide()
                    $(this).addClass("tabhover")
                    var index = $(this).attr("index")
                    $(".con_one_list ul").each(function () {
                        if (index == $(this).attr("index")) {
                            $(this).fadeIn()
                        }
                    })
                }


            }, function () {

            })
        })

        //自定义JS中字符串格式化方法
        String.prototype.format = function (args) {
            if (arguments.length > 0) {
                var result = this;
                if (arguments.length == 1 && typeof (args) == "object") {
                    for (var key in args) {
                        var reg = new RegExp("({" + key + "})", "g");
                        result = result.replace(reg, args[key]);
                    }
                }
                else {
                    for (var i = 0; i < arguments.length; i++) {
                        if (arguments[i] == undefined) {
                            return "";
                        }
                        else {
                            var reg = new RegExp("({[" + i + "]})", "g");
                            result = result.replace(reg, arguments[i]);
                        }
                    }
                }
                return result;
            }
            else {
                return this;
            }
        }


    </script>
{% endblock %}
{% block style %}
    <style>
        .page-ico{
            text-align: center;
            display: none;
        }
        .page-ico i{
            font-size: 10px;
        }
    </style>
{% endblock %}

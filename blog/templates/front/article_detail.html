{% extends 'front/home_index.html' %}
{% load staticfiles %}
{% block template %}
    <div class="article-detail-container">
        <header>

            <div id="font-change" class="left">
                <span id="font-dec"><a href="#" title="减小字体">-</a></span>
                <span id="font-n"><a href="#" title="默认大小">N</a></span>
                <span id="font-inc"><a href="#" title="增大字体">+</a></span>
            </div>

            <div class="post-meta">
                <span class="time">{{ article_zy.articleTime|date:"Y年m月d日" }}</span>
                <span class="eye"><i class="fa fa-eye"></i>&nbsp;{{ article_zy.articleClick }}</span>
                <span class="comm"><a href="https://www.talklee.com/guestbook/#comments"><i class="fa fa-comment-o"></i>&nbsp;{{ article_zy.articleComment }}</a></span>
                <span class="r-hide">
                    <a title="侧边栏">
                        <i style="padding-left: 5px" class="fa fa-caret-left"></i>
                        <i class="fa fa-caret-right"></i>
                    </a>
                </span>
            </div>

            <h2 class="post-title"><a href="https://www.talklee.com/guestbook/" title="正在阅读：{{ article.title }}"
                                      rel="bookmark">{{ article.title }}</a>
            </h2>
        </header>
        <div class="main">
            {% autoescape off %}
                {{ article.content }}
            {% endautoescape %}
        </div>
        <div class="ds-reward-stl">
            <button id="dsRewardBtn" onclick="PaymentUtils.show();"><i class="fa fa-usd"></i>赏</button>

        </div>
        <div class="entry-meta">
            <p class="post-tag">标签：<a href="https://www.talklee.com/tags-11.html" rel="tag"
                                      title="查看标签为《建站》的所有文章">建站</a><a href="https://www.talklee.com/tags-20.html"
                                                                      rel="tag" title="查看标签为《自媒体》的所有文章">自媒体</a><a
                    href="https://www.talklee.com/tags-18.html" rel="tag" title="查看标签为《资讯》的所有文章">资讯</a><a
                    href="https://www.talklee.com/tags-21.html" rel="tag" title="查看标签为《新闻》的所有文章">新闻</a><a
                    href="https://www.talklee.com/tags-3.html" rel="tag" title="查看标签为《投稿》的所有文章">投稿</a></p>
            <p class="post-tag">
                个人类目:
                <a>test</a>
            </p>
        </div>
        <div id="comments">
            <h4><i class="fa fa-pencil"></i>发表评论<span><a rel="nofollow" id="cancel-reply" href="#comment"
                                                         style="display:none;"></a></span><span
                    class="jubao"><a rel="nofollow" href="http://www.12377.cn/" target="_blank"><small><i
                    class="fa fa-exclamation-triangle"></i>中国互联网举报中心</small></a></span></h4>

            <div id="editor">
                <p>文章很好，非常不错赞一个</p>
            </div>
            <input id="btn-coments" type="button" value="提交评论">
            <div class="come-comt">
                <i class="fa fa-comments"></i>评论列表 <span id="comment_count">（已有<span
                    style="color:#E1171B">{{ article_zy.articleComment }}</span>条评论，共<span
                    style="color:#E1171B">21135</span>人参与）</span><span
                    class="iliuyan"><a href="https://www.talklee.com/guestbook/#comment"><i class="fa fa-bell"></i>参与讨论</a></span>
            </div>
            {% for item in comments %}
                {% if not item.fatherComment_id %}
                    <div class="msg">
                        <div class="msgauto" style="position: relative">
                            <img class="avatar" src="{% static 'images/logo.JPG' %}"
                                 alt="网友昵称：{{ item.commentUser.userName }}"
                                 title="网友昵称：{{ item.commentUser.userName }}">
                            <div class="msgname">
                                <a href="#">{{ item.commentUser.userName }}</a>
                                <span>{{ item.commentTime }}</span>
                                <h3>#{{ forloop.revcounter }}楼</h3>
                            </div>
                        </div>
                        <div class="msgtxt">
                <span>
                    {% autoescape off %}
                        {{ item.commentContent }}
                    {% endautoescape %}
                </span>
                        </div>

                        <div class="btn-send">
                             <span parentId="{{ item.commentId }}">
                                <i class="iconfont icon-huifu"></i>
                                回复
                            </span>
                            <span>
                                <i class="iconfont icon-dianzan"></i>
                                6人赞
                            </span>
                            {% for subitem in comments %}
                                {% if item.commentId == subitem.fatherComment_id %}
                                    <div style="margin-top: 10px;padding: 10px;font-weight: 100;font-size: 20px;margin-left: 40px;border-left: 1px solid #398D9F">
                                        <a style="padding: 5px;color: #50ABDF">{{ subitem.commentUser.userName }}:</a>
                                        <span style="color:#999999">    `
                                        {{ subitem.commentContent }}
                                   </span>
                                        <div style="margin-top: 20px">
                                            <span style="margin-right: 20px">{{ subitem.commentTime }}</span>
                                            <span class="btn-send-huifu-ziji">
                                            <i class="iconfont icon-huifu"></i>
                                                回复
                                        </span>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}


                        </div>


                        <div style="display: none" class="send-input">
                            <textarea placeholder="写下你的回复"></textarea>
                            <div>
                                <input class="btn-cancel-huifu" type="button" value="取消">
                                <input class="btn-send-huifu" type="button" value="发送">
                            </div>

                        </div>
                    </div>
                {% endif %}

            {% endfor %}


        </div>

        <div class="tooltip">
            <i class="iconfont icon-error"></i>
            <span></span>
        </div>
    </div>
{% endblock %}

{% block script %}
    <script type="text/javascript"
            src="{% static 'frame/pay/award.js' %}"></script>
    <script src="{% static 'frame/wangEditor/release/wangEditor.js' %}"></script>
    <script type="text/javascript">
        var E = window.wangEditor
        var editor = new E('#editor')
        // 或者 var editor = new E( document.getElementById('editor') )
        // 自定义菜单配置
        editor.customConfig.menus = [
            'head',  // 标题
            'bold',  // 粗体
            'fontSize',  // 字号
            'fontName',  // 字体
            'italic',  // 斜体
            'underline',  // 下划线
            'strikeThrough',  // 删除线
            'foreColor',  // 文字颜色
            'backColor',  // 背景颜色
            'link',  // 插入链接
            'justify',  // 对齐方式
            'quote',  // 引用
            'emoticon',  // 表情
        ]
        editor.customConfig.zIndex = 0
        editor.create()

        $(function () {
            //移除富文本编译器多的p标签
            $(".msgtxt>span p:last-child").remove()
            $("#editor .w-e-text-container").css({
                "height": '200px',
            })
            $("#editor>div:first-child").css({
                "background-color": '#dbe8eb',
            })
            $("#editor>div:last-child").css({
                "z-index": 0
            })

            //用户发送评论
            $("#btn-coments").click(function () {
                var content = editor.txt.html().trim()
                var text = editor.txt.text().trim()
                var article_id = "{{article.article_uid}}"
                var comments_count = $("#comment_count>span:eq(0)").text()
                if (text == "") {
                    $(".tooltip span").text('回复内容不能为空')
                    $(".tooltip").slideDown(function () {
                        setTimeout(function () {
                            $(".tooltip").hide()
                        }, 2000)

                    })
                } else {
                    $.ajax({
                        url: "{% url 'blog:comments' %}",
                        method: 'POST',
                        data: {"content": content, "article_id": article_id, "comments_count": comments_count},
                        dataType: 'JSON',
                        success: function (data) {
                            if (data.code == 0) {
                                $(".tooltip span").text('评论成功')
                                $(".tooltip").slideDown(function () {
                                    setTimeout(function () {
                                        window.location.reload()
                                    }, 1000)

                                })

                            }
                        }
                    })
                }

            })

            //回复
            $("#comments .msg .btn-send>span:first-child").click(function () {
                $(this).parent().next().toggle({
                    easing: "easeOutBounce"
                })
            })

            $(".btn-cancel-huifu").click(function () {
                $(this).parent().parent().hide({
                    easing: "easeOutBounce"
                })
            })

            $(".btn-send-huifu").click(function () {
                var content = $(this).parent().prev().val().trim()
                var article_id = "{{article.article_uid}}"
                var comments_count = $("#comment_count>span:eq(0)").text()
                var parentId = $(".btn-send>span:first-child").attr("parentId")
                if (content == "") {
                    $(".tooltip span").text('回复内容不能为空')
                    $(".tooltip").slideDown(function () {
                        setTimeout(function () {
                            $(".tooltip").hide()
                        }, 2000)

                    })
                } else {
                    $.ajax({
                        url: "{% url 'blog:comments' %}",
                        method: "POST",
                        data: {
                            "content": content,
                            "article_id": article_id,
                            "comments_count": comments_count,
                            "parentId": parentId
                        },
                        dataType: 'JSON',
                        success: function (data) {
                            if (data.code == 0) {
                                $(this).parent().parent().hide({
                                    easing: "easeOutBounce"
                                })
                                $(".tooltip span").text('回复成功')
                                $(".tooltip").slideDown(function () {
                                    setTimeout(function () {
                                        window.location.reload()
                                    }, 1000)

                                })
                            }
                        }
                    })
                }


            })

            $(".btn-send-huifu-ziji").click(function () {
                $(this).parents('div.btn-send').next().toggle({
                    easing: "easeOutBounce"
                })
            })


        })
    </script>
{% endblock %}



{% block style %}
    <link rel="stylesheet" href="{% static 'frame/pay/award.css' %}">
    <style>
        div.article-detail-container > header span {
            color: #999;
            line-height: 26px;
            margin: 0 5px 0 0;
            padding: 0px 8px;
            display: inline-block;
            border: 1px solid #ddd;
            border-radius: 2px;

        }

        div.article-detail-container > header > div {
            float: left;
        }

        div.article-detail-container > header {
            width: 80%;
            background-color: white;
            border: 1px solid whitesmoke;
            padding: 15px;
            height: 100%;

        }

        div.article-detail-container div.post-meta {
            float: right;
        }

        div.article-detail-container h2.post-title {
            display: block;
            font-weight: bold;
            background: #ebebeb;
            font-size: 18px;
            line-height: 30px;
            margin: 45px -15px 10px -15px;
            padding: 6px 20px;
            border-left: 5px solid #2f889a;
            border-right: 5px solid #2f889a;
            text-align: center;
        }

        div.article-detail-container > div.main {
            width: 80%;
            background-color: white;
            border: 1px solid whitesmoke;
            padding: 15px;
            height: 100%;
        }

        div.article-detail-container > div.ds-reward-stl {
            width: 80%;
            background-color: white;
            border: 1px solid whitesmoke;
            padding: 15px;
            height: 100%;
            text-align: center;
            font-family: "microsoft yahei";
        }

        div.article-detail-container > div.ds-reward-stl #dsRewardBtn {
            margin: 0;
            background: #FF6969;
            font-size: 16px;
            font-weight: 600;
            border: 4px solid #fff;
            border-radius: 50px;
            color: #FFFFFF;
            padding: 8px 30px;
            transition: all .3s ease-out 0s;
            outline: 0;
            cursor: pointer;
        }

        div.article-detail-container > div.ds-reward-stl #dsRewardBtn:hover {
            background-color: #30879A;
        }

        div.article-detail-container > div.entry-meta {
            padding: 2px 20px;
            width: 80%;
            background-color: white;
            border: 1px solid whitesmoke;
            padding: 15px;
            height: 100%;
        }

        div.article-detail-container > div.entry-meta .post-tag a {
            padding: 3px 8px;
            border: 1px solid #eee;
            margin-right: 5px;
            line-height: 35px;
        }

        div.article-detail-container > div#comments {
            width: 80%;
            background-color: white;
            border: 1px solid whitesmoke;
            padding: 15px;
            height: 100%;

        }

        div.article-detail-container > div#comments h3, #comments h4 {
            font-size: 16px;
            font-weight: 300;
            line-height: 2;
            padding: 0 8px;
            margin: 10px 0 15px;
            border-bottom: 1px solid #398E9F;
            color: #398E9F;
        }

        div.article-detail-container > div#comments h4 span.jubao {
            float: right;
            margin-right: 0;
        }

        div.article-detail-container > div#comments h4 span.jubao small {
            color: #338A9C;
        }

        #btn-coments {
            color: #FFFFFF;
            background-color: #398E9F;
            height: 30px;
            width: 88px;
            border-radius: 4px;
            cursor: pointer;
            outline: 0;
            border: 0;
            margin-top: 10px;
        }

        .come-comt {
            font-size: 16px;
            color: #398E9F;
            margin-top: 30px;
            line-height: 25px;
            border-bottom: 1px solid #398E9F;
            padding: 5px 0 5px 5px;
        }

        .come-comt i.fa {
            margin-right: 3px;
            font-size: 18px;
            font-size: 1.1em;
        }

        #comments span#comment_count {
            font-weight: normal;
            font-size: 14px;
            color: #666;
            float: none !important;
        }

        #comments span.iliuyan {
            float: right;
            margin-right: 0;
        }

        #comments span.iliuyan > :hover {
            color: #EB6E59;
        }

        #comments .msg {
            font-size: 12px;
            line-height: 22px;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 18px;
            margin-bottom: 10px;
        }

        #comments .msg .msgauto img {
            margin-right: 10px;
            padding: 2px;
            height: 58px;
            width: 58px;
            border: 1px solid #ddd;
            background-color: #f1f1f1;
            border-radius: 50px;
            -webkit-border-radius: 50px;
            -moz-border-radius: 50px;
            -webkit-transition: 0.4s;
            -webkit-transition: -webkit-transform 0.4s ease-out;
            -moz-transition: -moz-transform 0.4s ease-out;
            transition: transform 0.4s ease-out;
        }

        #comments .msg .msgname {
            color: #999999;
            position: absolute;
            top: 20px;
            left: 100px;

        }

        .msgname > a, .msgname > span {
            font-size: 20px;
            margin-right: 5px;
        }

        #comments .msg .msgtxt {
            font-size: 15px;
            font-weight: 100;
            padding-top: 5px;
        }

        #comments .msg .btn-send {
            margin-top: 20px;
        }

        #comments .msg .btn-send > span {
            padding: 10px;
            cursor: pointer;
            font-size: 15px;
        }

        #comments .msg .btn-send > span > i {
            font-size: 20px;
        }

        #comments .msg .btn-send > span:hover {
            color: #76A8D5;
            font-weight: 800;
        }

        #comments .msg .send-input > textarea {
            width: 90%;
            height: 100px;
            outline: 0;
            padding: 20px;
            margin-top: 15px;
        }

        .container .tooltip {
            position: fixed;
            top: 0;
            color: red;
            display: none;
            right: 50%;
            top: 150px;
            border-radius: 10px;
            padding: 10px;
            border: 1px solid red;
        }

        #comments .msg .send-input > div {
            margin-top: 10px;
        }

        #comments .msg .send-input > div > input {
            color: #FFFFFF;
            background-color: #398E9F;
            height: 30px;
            width: 88px;
            border-radius: 4px;
            cursor: pointer;
            outline: 0;
            border: 0;
            margin-top: 10px;
            font-weight: 800;
            margin-right: 10px;
        }

        .btn-send-huifu-ziji {
            cursor: pointer;
        }

        .btn-send-huifu-ziji:hover {
            color: #4FABDF;
        }
    </style>
{% endblock %}